<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Earth Flight Path</title>
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; height: 100%; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js';

    // 장면 생성
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 3;

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);

    // 지구 구체 (텍스처 없이 파란색)
    const earthGeometry = new THREE.SphereGeometry(1, 64, 64);
    const earthMaterial = new THREE.MeshBasicMaterial({ color: 0x3399ff });
    const earth = new THREE.Mesh(earthGeometry, earthMaterial);
    scene.add(earth);

    // 위도/경도/고도 → 3D 위치 변환 함수
    function latLonAltToVec3(lon, lat, alt) {
      const phi = (90 - lat) * Math.PI / 180;
      const theta = (lon + 180) * Math.PI / 180;
      const radius = 1 + alt;
      return new THREE.Vector3(
        radius * Math.sin(phi) * Math.cos(theta),
        radius * Math.cos(phi),
        radius * Math.sin(phi) * Math.sin(theta)
      );
    }

    // 예시 비행 경로 데이터 (경도, 위도, 고도)
    const flightPoints = [
      [-0.4543, 51.4700, 0.02],   // London Heathrow
      [8.6821, 50.1109, 0.03],    // Frankfurt
      [2.3522, 48.8566, 0.04],    // Paris
      [7.2620, 43.7102, 0.05],    // Nice
      [12.4964, 41.9028, 0.06]    // Rome
    ];

    // 궤적 선 그리기
    const flightGeometry = new THREE.BufferGeometry();
    const positions = [];

    flightPoints.forEach(([lon, lat, alt]) => {
      const pos = latLonAltToVec3(lon, lat, alt);
      positions.push(pos.x, pos.y, pos.z);
    });

    flightGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
    const flightLine = new THREE.Line(
      flightGeometry,
      new THREE.LineBasicMaterial({ color: 0xff0000 })
    );
    scene.add(flightLine);

    // 렌더링 루프
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
